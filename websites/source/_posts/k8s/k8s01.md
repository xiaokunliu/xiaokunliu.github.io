---
title: k8s简介
category: k8s
date: 2021-04-18 18:44:43
tags: k8s
---

<!-- more -->



### k8s简介说明

#### 部署升级迭代演进
![](/Users/keithl/github/personal/xiaokunliu.github.io/websites/zimages/k8s/k8s_01.jpg)


#### k8s提供的资源
- 服务注册发现与负载均衡
- 存储编排
- 自动伸缩与回滚
- 自动对分布式服务进行装箱
- 自我修复
- 加密与配置管理

### k8s组件
![](/Users/keithl/github/personal/xiaokunliu.github.io/websites/zimages/k8s/k8s_02.jpg)

#### k8s控制面板的组件(Master)
- kube-apiserver
- etcd
- kube-scheduler
- kube-controller-manager
    - Node Controller
    - Job Controller
    - Endpoints Controller
    - Service Account & Token Controllers
- cloud-controller-manager
    - Node Controller
    - Route Controller
    - Service Controller


#### k8s工作Node的组件
- kubelet
- kube-proxy(service mesh)
- container runtime

#### k8s架构以及组件执行流程

##### Borg架构设计

![](/Users/keithl/docker/data/xiaokunliu.github.io/websites/zimages/k8s/k8s_03.jpg)

##### k8s架构

- k8s组件协作流程架构

![](/Users/keithl/docker/data/xiaokunliu.github.io/websites/zimages/k8s/k8s_04.jpg)

![](/Users/keithl/docker/data/xiaokunliu.github.io/websites/zimages/k8s/k8s_05.jpg)

上层服务: kubectl/Web UI,对外提供声明式API或者是控制面

Master服务:提供集群管理以及服务注册发现数据存储.

Node服务: 提供实际工作的容器执行服务.

- k8s整体架构示意图

![](/Users/keithl/docker/data/xiaokunliu.github.io/websites/zimages/k8s/k8s_07.jpg)

![](/Users/keithl/docker/data/xiaokunliu.github.io/websites/zimages/k8s/k8s_08.jpg)

- Master架构

![](/Users/keithl/docker/data/xiaokunliu.github.io/websites/zimages/k8s/k8s_09_master.jpg)

- Node架构

![](/Users/keithl/docker/data/xiaokunliu.github.io/websites/zimages/k8s/k8s_10_nodes.jpg)

- 分层架构

![](/Users/keithl/docker/data/xiaokunliu.github.io/websites/zimages/k8s/k8s_11.jpg)

##### k8s节点与容器关系

- Node节点
- Pod节点
- container-docker节点

![](/Users/keithl/docker/data/xiaokunliu.github.io/websites/zimages/k8s/k8s_06.jpg)

一个Node节点可以有多个Pod节点,而一个Pod节点包含多个container runtime的实例.

##### 组件执行流程(TODO)



### macbook安装k8s

```text
## 参考
https://juejin.cn/post/6844903950496301063
```

- 配置镜像源
```text
## docker 要配置好
{
  "features": {
    "buildkit": true
  },
  "experimental": true,
  "debug": true,
  "builder": {
    "gc": {
      "enabled": true,
      "defaultKeepStorage": "20GB"
    }
  },
  "registry-mirrors": [
    "https://yourAliId.mirror.aliyuncs.com"
  ]
}
```

- 配置k8s的镜像
```text
## 参考
https://github.com/maguowei/k8s-docker-desktop-for-mac
```

- 安装过程遇到问题(TODO)

```text
## qs:
an error on the server ("") has prevented the request from succeeding

## sovle:
## 重装docker-destop 以及 在安装之后重新配置docker的资源仓库并下载k8s相关的镜像
```

- 安装Dashboard
```text
https://github.com/maguowei/gotok8s#%E9%83%A8%E7%BD%B2-kubernetes-dashboard

## 查看证书
kubectl -n kubernetes-dashboard get secret
kubectl -n kubernetes-dashboard describe secret kubernetes-dashboard-admin-token-xxxx

```

- 安装helm

```text
## helm 是k8s的包管理器，类似于npm/maven
brew install helm
```

- 添加helm的仓库地址
```text
## 参考：https://github.com/maguowei/gotok8s#%E9%83%A8%E7%BD%B2-kubernetes-dashboard
## 仓库地址：TODO
helm repo add stable 
helm repo add incubator 
```

- 安装ingress(TODO)


#### k8s依赖的工具组件安装

